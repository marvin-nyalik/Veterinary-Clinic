/* Database schema to keep the structure of entire database. */
CREATE DATABASE vet_clinic;
\c vet_clinic;

CREATE TABLE animals(
id INT GENERATED BY DEFAULT AS IDENTITY,
name VARCHAR(50) NOT NULL,
date_of_birth date,
escape_attempts INT,
neutered boolean,
weight_kg decimal(4,2));

ALTER TABLE animals ADD COLUMN species varchar(50);

CREATE TABLE owners (
id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
full_name VARCHAR(255),
age integer
);

CREATE TABLE species(
id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
name VARCHAR(255)
);

ALTER TABLE animals
DROP COLUMN species,
ADD COLUMN species_id integer,
ADD COLUMN owner_id integer,
ADD CONSTRAINT fk_species FOREIGN KEY(species_id) REFERENCES species(id) ON DELETE CASCADE,
ADD CONSTRAINT fk_owner FOREIGN KEY(owner_id) REFERENCES owners(id) ON DELETE CASCADE;

CREATE TABLE vets (
  id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  name VARCHAR(255),
  age integer,
  date_of_graduation date
);

CREATE TABLE specializations (
  species_id integer,
  vet_id integer,
  CONSTRAINT species_fk FOREIGN KEY (species_id) REFERENCES species(id) ON DELETE CASCADE,
  CONSTRAINT vets_fk FOREIGN KEY (vet_id) REFERENCES vets(id) ON DELETE CASCADE
);

CREATE TABLE visits (
    animal_id integer,
    vet_id integer,
    visit_date date,
    CONSTRAINT animals_fk FOREIGN KEY (animal_id) REFERENCES animals(id) ON DELETE CASCADE,
    CONSTRAINT vets_fk FOREIGN KEY (vet_id) REFERENCES vets(id) ON DELETE CASCADE
);

ALTER TABLE owners ADD COLUMN email VARCHAR(120);

CREATE INDEX visits_animal_id ON visits(animal_id);
CREATE INDEX visits_vet_id ON visits(vet_id);
CREATE INDEX owner_email_index ON owners(email);
